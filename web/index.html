<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>PASSLOCK</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&display=swap');
        
        *{margin:0;padding:0;box-sizing:border-box}
        body{
            background:#0a0e27;
            color:#e0e7ff;
            font-family:'JetBrains Mono',monospace;
            padding:20px;
            min-height:100vh;
            position:relative;
            overflow-x:hidden;
        }
        
        #matrix{
            position:fixed;
            top:0;
            left:0;
            width:100%;
            height:100%;
            opacity:0.03;
            z-index:0;
            pointer-events:none;
        }
        
        .c{max-width:1000px;margin:0 auto;position:relative;z-index:1}
        
        .hd{
            text-align:center;
            padding:30px;
            border:2px solid #4ade80;
            border-radius:15px;
            margin-bottom:25px;
            background:linear-gradient(135deg, rgba(16,24,48,0.95) 0%, rgba(10,14,39,0.98) 100%);
            box-shadow:0 0 30px rgba(74,222,128,0.15),inset 0 0 50px rgba(74,222,128,0.03);
            position:relative;
            overflow:hidden;
        }
        
        .hd::before{
            content:'';
            position:absolute;
            top:-50%;
            left:-50%;
            width:200%;
            height:200%;
            background:linear-gradient(45deg, transparent, rgba(74,222,128,0.05), transparent);
            animation:scan 4s linear infinite;
        }
        
        @keyframes scan{
            0%{transform:translateX(-100%) translateY(-100%) rotate(45deg)}
            100%{transform:translateX(100%) translateY(100%) rotate(45deg)}
        }
        
        .hd h1{
            color:#4ade80;
            font-size:2.5em;
            margin-bottom:8px;
            font-weight:700;
            letter-spacing:3px;
            text-shadow:0 0 20px rgba(74,222,128,0.5);
            position:relative;
        }
        
        .hd h1::after{
            content:'';
            position:absolute;
            bottom:-5px;
            left:50%;
            transform:translateX(-50%);
            width:60px;
            height:2px;
            background:linear-gradient(90deg, transparent, #4ade80, transparent);
        }
        
        .hd p{
            color:#94a3b8;
            font-size:0.9em;
            letter-spacing:2px;
            position:relative;
        }
        
        .lock-icon{
            display:inline-block;
            animation:lockPulse 2s ease-in-out infinite;
        }
        
        @keyframes lockPulse{
            0%,100%{transform:scale(1);opacity:1}
            50%{transform:scale(1.1);opacity:0.8}
        }
        
        .bx{
            padding:40px;
            border:2px solid #4ade80;
            border-radius:15px;
            background:linear-gradient(135deg, rgba(16,24,48,0.9) 0%, rgba(10,14,39,0.95) 100%);
            max-width:420px;
            margin:40px auto;
            box-shadow:0 0 40px rgba(74,222,128,0.2),inset 0 0 60px rgba(74,222,128,0.02);
            position:relative;
            animation:fadeIn 0.5s ease-out;
        }
        
        @keyframes fadeIn{
            from{opacity:0;transform:translateY(20px)}
            to{opacity:1;transform:translateY(0)}
        }
        
        .bx::before{
            content:'';
            position:absolute;
            top:0;
            left:0;
            right:0;
            bottom:0;
            border-radius:15px;
            padding:2px;
            background:linear-gradient(45deg, #4ade80, #22c55e, #4ade80);
            -webkit-mask:linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite:xor;
            mask-composite:exclude;
            opacity:0;
            animation:borderGlow 3s ease-in-out infinite;

            pointer-events: none;
        }
        
        @keyframes borderGlow{
            0%,100%{opacity:0.3}
            50%{opacity:0.8}
        }
        
        .bx h2{
            color:#4ade80;
            margin-bottom:25px;
            text-align:center;
            font-size:1.4em;
            font-weight:600;
            letter-spacing:1px;
            text-transform:uppercase;
        }
        
        input,textarea{
            width:100%;
            padding:14px;
            margin:10px 0;
            background:rgba(30,41,59,0.6);
            border:2px solid rgba(74,222,128,0.3);
            border-radius:8px;
            color:#e0e7ff;
            font-size:14px;
            font-family:'JetBrains Mono',monospace;
            transition:all 0.3s ease;
        }
        
        input:focus,textarea:focus{
            outline:0;
            border-color:#4ade80;
            background:rgba(30,41,59,0.8);
            box-shadow:0 0 20px rgba(74,222,128,0.2);
        }
        
        input::placeholder,textarea::placeholder{
            color:#64748b;
            font-family:'JetBrains Mono',monospace;
        }
        
        button{
            width:100%;
            padding:14px;
            margin:10px 0;
            background:linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            border:0;
            border-radius:8px;
            color:#fff;
            font-weight:600;
            cursor:pointer;
            font-size:14px;
            font-family:'JetBrains Mono',monospace;
            text-transform:uppercase;
            letter-spacing:1px;
            transition:all 0.3s ease;
            position:relative;
            overflow:hidden;
        }
        
        button::before{
            content:'';
            position:absolute;
            top:50%;
            left:50%;
            width:0;
            height:0;
            border-radius:50%;
            background:rgba(255,255,255,0.3);
            transform:translate(-50%,-50%);
            transition:width 0.6s,height 0.6s;
        }
        
        button:hover::before{
            width:300px;
            height:300px;
        }
        
        button:hover{
            transform:translateY(-2px);
            box-shadow:0 5px 25px rgba(74,222,128,0.4);
        }
        
        button:active{
            transform:translateY(0);
        }
        
        button.sc{
            background:linear-gradient(135deg, rgba(51,65,85,0.8) 0%, rgba(30,41,59,0.8) 100%);
            border:2px solid rgba(74,222,128,0.3);
        }
        
        button.sc:hover{
            border-color:#4ade80;
            background:linear-gradient(135deg, rgba(51,65,85,1) 0%, rgba(30,41,59,1) 100%);
        }
        
        button.dg{
            background:linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        button.dg:hover{
            box-shadow:0 5px 25px rgba(239,68,68,0.4);
        }
        
        .ct{
            display:flex;
            gap:12px;
            margin:20px 0;
            flex-wrap:wrap;
        }
        
        .ct button{
            width:auto;
            padding:12px 20px;
            flex:1;
            min-width:120px;
        }
        
        .srch{
            flex:2;
            min-width:200px;
        }
        
        .ent{margin-top:20px}
        
        .en{
            background:linear-gradient(135deg, rgba(30,41,59,0.4) 0%, rgba(15,23,42,0.6) 100%);
            border:2px solid rgba(74,222,128,0.2);
            border-radius:12px;
            padding:20px;
            margin-bottom:15px;
            transition:all 0.3s ease;
            position:relative;
            overflow:hidden;
        }
        
        .en::before{
            content:'';
            position:absolute;
            left:-100%;
            top:0;
            width:100%;
            height:100%;
            background:linear-gradient(90deg, transparent, rgba(74,222,128,0.1), transparent);
            transition:left 0.5s;
        }
        
        .en:hover::before{
            left:100%;
        }
        
        .en:hover{
            border-color:#4ade80;
            box-shadow:0 5px 30px rgba(74,222,128,0.2);
            transform:translateY(-2px);
        }
        
        .et{
            display:flex;
            justify-content:space-between;
            align-items:center;
            margin-bottom:15px;
        }
        
        .nm{
            color:#4ade80;
            font-size:1.2em;
            font-weight:700;
            letter-spacing:0.5px;
        }
        
        .bt{display:flex;gap:8px}
        
        .bt button{
            width:auto;
            padding:8px 14px;
            margin:0;
            font-size:12px;
        }
        
        .fd{
            margin:8px 0;
            display:flex;
            gap:12px;
            align-items:flex-start;
            padding:8px;
            border-radius:6px;
            transition:background 0.2s;
        }
        
        .fd:hover{
            background:rgba(74,222,128,0.05);
        }
        
        .fd .lb{
            color:#64748b;
            min-width:80px;
            font-size:13px;
            text-transform:uppercase;
            letter-spacing:0.5px;
        }
        
        .fd .vl{
            color:#10b981;
            flex:1;
            cursor:pointer;
            word-break:break-all;
            font-size:14px;
            font-weight:600;
            transition:all 0.2s;
        }
        
        .fd .vl:hover{
            color:#4ade80;
            text-shadow:0 0 10px rgba(74,222,128,0.5);
        }
        
        .hid{display:none!important}
        
        .md{
            position:fixed;
            top:0;
            left:0;
            right:0;
            bottom:0;
            background:rgba(0,0,0,0.92);
            backdrop-filter:blur(8px);
            display:flex;
            align-items:center;
            justify-content:center;
            z-index:999;
            animation:fadeIn 0.3s ease-out;
        }
        
        .mb{
            background:linear-gradient(135deg, rgba(16,24,48,0.98) 0%, rgba(10,14,39,0.98) 100%);
            border:2px solid #4ade80;
            border-radius:15px;
            padding:35px;
            max-width:500px;
            width:90%;
            max-height:90vh;
            overflow-y:auto;
            box-shadow:0 0 50px rgba(74,222,128,0.3);
            animation:modalPop 0.4s cubic-bezier(0.68,-0.55,0.265,1.55);
        }
        
        @keyframes modalPop{
            0%{transform:scale(0.8);opacity:0}
            100%{transform:scale(1);opacity:1}
        }
        
        .mh{
            color:#4ade80;
            font-size:1.4em;
            margin-bottom:20px;
            text-align:center;
            font-weight:700;
            letter-spacing:1px;
            text-transform:uppercase;
        }
        
        .ms{
            padding:14px;
            margin:12px 0;
            border-left:4px solid;
            border-radius:8px;
            font-size:14px;
            animation:slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn{
            from{transform:translateX(-20px);opacity:0}
            to{transform:translateX(0);opacity:1}
        }
        
        .ms.ok{
            border-color:#10b981;
            color:#10b981;
            background:rgba(16,185,129,0.1);
            box-shadow:0 0 15px rgba(16,185,129,0.2);
        }
        
        .ms.er{
            border-color:#ef4444;
            color:#ef4444;
            background:rgba(239,68,68,0.1);
            box-shadow:0 0 15px rgba(239,68,68,0.2);
        }
        
        .ms.inf{
            border-color:#3b82f6;
            color:#3b82f6;
            background:rgba(59,130,246,0.1);
            box-shadow:0 0 15px rgba(59,130,246,0.2);
        }
        
        .em{
            text-align:center;
            padding:40px;
            color:#64748b;
            font-size:15px;
            font-style:italic;
        }
        
        code{
            background:rgba(74,222,128,0.1);
            padding:4px 8px;
            border-radius:4px;
            color:#4ade80;
            font-family:'JetBrains Mono',monospace;
            border:1px solid rgba(74,222,128,0.3);
        }
        
        ::-webkit-scrollbar{width:8px;height:8px}
        ::-webkit-scrollbar-track{background:rgba(30,41,59,0.3);border-radius:4px}
        ::-webkit-scrollbar-thumb{background:rgba(74,222,128,0.3);border-radius:4px}
        ::-webkit-scrollbar-thumb:hover{background:rgba(74,222,128,0.5)}
        
        @keyframes spin{
            to{transform:rotate(360deg)}
        }
        
        .loading::after{
            content:'';
            display:inline-block;
            width:14px;
            height:14px;
            margin-left:8px;
            border:2px solid rgba(255,255,255,0.3);
            border-top-color:#fff;
            border-radius:50%;
            animation:spin 0.6s linear infinite;
        }
    </style>
</head>
<body>
    <canvas id="matrix"></canvas>
    
    <div class="c">
        <div class="hd">
            <h1>PASSLOCK</h1>
            <p>‚óà ENCRYPTED PASSWORD VAULT ‚óà</p>
        </div>
        
        <div id="nv" class="bx hid">
            <h2>‚ö† No Vault Detected</h2>
            <div class="ms inf">
                <strong>INITIALIZATION REQUIRED</strong><br>
                No encrypted vault found. Create one to begin securing your credentials.
            </div>
            <button onclick="shc()">üîí Initialize Vault</button>
            <div style="text-align:center;margin-top:20px;color:#64748b;font-size:13px">
                Alternative: CLI creation via<br>
                <code>cargo run --release</code>
            </div>
        </div>
        
        <div id="cv" class="bx hid">
            <h2>Create Master Key</h2>
            <input type="password" id="np" placeholder="Enter master password" autocomplete="new-password">
            <input type="password" id="cp" placeholder="Confirm master password" onkeypress="if(event.key==='Enter')cr()" autocomplete="new-password">
            <button onclick="cr()">Generate Vault</button>
            <button onclick="bk()" class="sc">‚Üê Return</button>
            <div id="cm"></div>
        </div>
        
        <div id="lg" class="bx hid">
            <h2>Unlock Vault</h2>
            <input type="password" id="pw" placeholder="Master password" onkeypress="if(event.key==='Enter')ul()" autocomplete="current-password">
            <button onclick="ul()">Decrypt & Access</button>
            <div id="lm"></div>
        </div>
        
        <div id="ap" class="hid">
            <div class="ct">
                <input type="text" id="qr" class="srch" placeholder="üîç Search vault..." oninput="sr()">
                <button onclick="sa()">‚ûï Add</button>
                <button onclick="sg()" class="sc">üé≤ Generate</button>
                <button onclick="sv()">üíæ Save</button>
                <button onclick="lo()" class="dg">üîí Lock</button>
            </div>
            <div id="ms"></div>
            <div id="es"></div>
        </div>
    </div>
    
    <div id="am" class="md hid" onclick="if(event.target===this)hd('am')">
        <div class="mb">
            <div class="mh">‚ûï New Entry</div>
            <input type="text" id="nm" placeholder="Service name (e.g., GitHub)">
            <input type="text" id="us" placeholder="Username / Email">
            <input type="text" id="ps" placeholder="Password">
            <input type="text" id="ur" placeholder="URL (optional)">
            <textarea id="nt" placeholder="Additional notes (optional)" rows="3"></textarea>
            <button onclick="ad()">üíæ Save Entry</button>
            <button onclick="hd('am')" class="sc">‚úï Cancel</button>
        </div>
    </div>
    
    <div id="gm" class="md hid" onclick="if(event.target===this)hd('gm')">
        <div class="mb">
            <div class="mh">üé≤ Password Generator</div>
            <input type="number" id="ln" value="16" min="4" max="64" placeholder="Password length">
            <button onclick="gn()">Generate Secure Password</button>
            <div id="go"></div>
            <button onclick="hd('gm')" class="sc">‚úï Close</button>
        </div>
    </div>
    
    <script>
        const canvas=document.getElementById('matrix');
        const ctx=canvas.getContext('2d');
        canvas.width=window.innerWidth;
        canvas.height=window.innerHeight;
        const chars='01„Ç¢„Ç§„Ç¶„Ç®„Ç™„Ç´„Ç≠„ÇØ„Ç±„Ç≥„Çµ„Ç∑„Çπ„Çª„ÇΩ„Çø„ÉÅ„ÉÑ„ÉÜ„Éà'.split('');
        const fontSize=14;
        const columns=canvas.width/fontSize;
        const drops=Array(Math.floor(columns)).fill(1);
        
        function drawMatrix(){
            ctx.fillStyle='rgba(10,14,39,0.05)';
            ctx.fillRect(0,0,canvas.width,canvas.height);
            ctx.fillStyle='#4ade80';
            ctx.font=fontSize+'px monospace';
            for(let i=0;i<drops.length;i++){
                const text=chars[Math.floor(Math.random()*chars.length)];
                ctx.fillText(text,i*fontSize,drops[i]*fontSize);
                if(drops[i]*fontSize>canvas.height&&Math.random()>0.975)drops[i]=0;
                drops[i]++;
            }
        }
        setInterval(drawMatrix,50);
        
        window.addEventListener('resize',()=>{
            canvas.width=window.innerWidth;
            canvas.height=window.innerHeight;
        });
        
        let p='',vt=[];
        async function ap(a,d={}){
            try{
                const r=await fetch('/api',{
                    method:'POST',
                    headers:{'Content-Type':'application/json'},
                    body:JSON.stringify({act:a,...d})
                });
                return await r.json();
            }catch(e){
                return{ok:false,msg:'network error'};
            }
        }
        async function chk(){
            const d=await ap('check');
            if(d.ok){
                if(d.exists){
                    document.getElementById('lg').classList.remove('hid');
                }else{
                    document.getElementById('nv').classList.remove('hid');
                }
            }
        }
        function shc(){
            document.getElementById('nv').classList.add('hid');
            document.getElementById('cv').classList.remove('hid');
        }
        function bk(){
            document.getElementById('cv').classList.add('hid');
            document.getElementById('nv').classList.remove('hid');
        }
        async function cr(){
            const np=document.getElementById('np').value;
            const cp=document.getElementById('cp').value;
            if(!np||!cp){
                sm('cm','‚ö† Password fields required','er');
                return;
            }
            if(np!==cp){
                sm('cm','‚ö† Passwords do not match','er');
                return;
            }
            if(np.length<4){
                sm('cm','‚ö† Minimum 4 characters required','er');
                return;
            }
            const d=await ap('create',{pwd:np,confirm:cp});
            if(d.ok){
                sm('cm','‚úì Vault encrypted successfully','ok');
                setTimeout(()=>{
                    document.getElementById('cv').classList.add('hid');
                    document.getElementById('lg').classList.remove('hid');
                },1500);
            }else{
                sm('cm','‚ö† '+d.msg,'er');
            }
        }
        async function ul(){
            p=document.getElementById('pw').value;
            if(!p){
                sm('lm','‚ö† Password required','er');
                return;
            }
            const btn=event.target;
            btn.classList.add('loading');
            btn.disabled=true;
            const d=await ap('unlock',{pwd:p});
            btn.classList.remove('loading');
            btn.disabled=false;
            if(d.ok){
                document.getElementById('lg').classList.add('hid');
                document.getElementById('ap').classList.remove('hid');
                ld();
            }else{
                sm('lm','‚ö† Decryption failed - Invalid password','er');
            }
        }
        async function ld(){
            const d=await ap('list');
            if(d.ok){
                vt=d.data||[];
                rn(vt);
            }
        }
        function rn(e){
            const c=document.getElementById('es');
            if(!e||e.length===0){
                c.innerHTML='<div class="em">Vault is empty - No credentials stored yet</div>';
                return;
            }
            let h='';
            e.forEach(x=>{
                h+='<div class="en"><div class="et"><div class="nm">üîë '+x.n+'</div><div class="bt"><button onclick="cp(\''+x.p.replace(/'/g,"\\'")+'\')">üìã Copy</button><button onclick="dl(\''+x.id+'\')" class="dg">üóë Delete</button></div></div>';
                h+='<div class="fd"><span class="lb">User:</span><span class="vl" onclick="cp(\''+x.u.replace(/'/g,"\\'")+'\')">'+x.u+'</span></div>';
                h+='<div class="fd"><span class="lb">Pass:</span><span class="vl" onclick="cp(\''+x.p.replace(/'/g,"\\'")+'\')">'+x.p+'</span></div>';
                if(x.url)h+='<div class="fd"><span class="lb">URL:</span><span class="vl">'+x.url+'</span></div>';
                if(x.nt)h+='<div class="fd"><span class="lb">Notes:</span><span class="vl">'+x.nt+'</span></div>';
                h+='</div>';
            });
            c.innerHTML=h;
        }
        function sr(){
            const q=document.getElementById('qr').value.toLowerCase();
            if(!q){
                rn(vt);
                return;
            }
            const f=vt.filter(e=>e.n.toLowerCase().includes(q)||e.u.toLowerCase().includes(q)||(e.url&&e.url.toLowerCase().includes(q)));
            rn(f);
        }
        function sa(){
            sh('am');
        }
        function sg(){
            sh('gm');
        }
        function sh(i){
            document.getElementById(i).classList.remove('hid');
        }
        function hd(i){
            document.getElementById(i).classList.add('hid');
        }
        async function ad(){
            const n=document.getElementById('nm').value.trim(),
                u=document.getElementById('us').value.trim(),
                ps=document.getElementById('ps').value.trim(),
                ur=document.getElementById('ur').value.trim(),
                nt=document.getElementById('nt').value.trim();
            if(!n||!u||!ps){
                sm('ms','‚ö† Name, username, and password required','er');
                return;
            }
            const d=await ap('add',{name:n,user:u,pass:ps,url:ur,note:nt});
            if(d.ok){
                ld();
                hd('am');
                sm('ms','‚úì Entry encrypted and added','ok');
                document.getElementById('nm').value='';
                document.getElementById('us').value='';
                document.getElementById('ps').value='';
                document.getElementById('ur').value='';
                document.getElementById('nt').value='';
            }
        }
        async function dl(i){
            if(!confirm('‚ö† Permanently delete this entry?'))return;
            const d=await ap('delete',{id:i});
            if(d.ok){
                ld();
                sm('ms','‚úì Entry deleted','ok');
            }
        }
        async function gn(){
            const l=parseInt(document.getElementById('ln').value)||16;
            const d=await ap('gen',{len:l});
            if(d.ok){
                document.getElementById('go').innerHTML='<div class="ms ok"><strong>‚úì Generated:</strong><br><span class="vl" onclick="cp(\''+d.data.replace(/'/g,"\\'")+'\')" style="font-size:1.1em;margin-top:10px;display:block;text-align:center">'+d.data+'</span><div style="text-align:center;margin-top:8px;font-size:12px;color:#64748b">Click to copy</div></div>';
            }
        }
        async function sv(){
            const btn=event.target;
            btn.classList.add('loading');
            btn.disabled=true;
            const d=await ap('save');
            btn.classList.remove('loading');
            btn.disabled=false;
            if(d.ok){
                sm('ms','‚úì Changes encrypted and saved to vault','ok');
            }else{
                sm('ms','‚ö† '+d.msg,'er');
            }
        }
        function cp(t){
            navigator.clipboard.writeText(t).then(()=>{
                sm('ms','‚úì Copied to clipboard','ok');
            }).catch(()=>sm('ms','‚ö† Copy failed','er'));
        }
        function sm(i,m,t){
            const el=document.getElementById(i);
            el.innerHTML='<div class="ms '+t+'">'+m+'</div>';
            setTimeout(()=>el.innerHTML='',3000);
        }
        function lo(){
            if(!confirm('Lock vault and logout?'))return;
            p='';
            vt=[];
            document.getElementById('lg').classList.remove('hid');
            document.getElementById('ap').classList.add('hid');
            document.getElementById('pw').value='';
        }
        chk();
    </script>
</body>
</html>